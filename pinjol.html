<?php
$servername = "localhost";
$username = "username";
$password = "password";
$dbname = "nama_database";

$conn = new mysqli($servername, $username, $password, $dbname);

if ($conn->connect_error) {
    die("Koneksi ke database gagal: " . $conn->connect_error);
}
?>

<?php
if ($_SERVER["REQUEST_METHOD"] == "POST" && isset($_POST["submit_peminjaman"])) {
    $nama = $_POST["nama"];
    $no_ktp = $_POST["no_ktp"];
    $tgl_lahir = $_POST["tgl_lahir"];
    $jumlah_peminjaman = $_POST["jumlah_peminjaman"];
    $jatuh_tempo = $_POST["jatuh_tempo"];

    // Lakukan validasi data

    // Kurangkan jumlah peminjaman dari saldo
    $saldo_awal = 100000000; // Saldo awal
    $saldo_akhir = $saldo_awal - $jumlah_peminjaman;

    // Simpan data peminjaman ke database
    $sql = "INSERT INTO peminjaman (nama, no_ktp, tgl_lahir, jumlah_peminjaman, jatuh_tempo) VALUES ('$nama', '$no_ktp', '$tgl_lahir', '$jumlah_peminjaman', '$jatuh_tempo')";
    if ($conn->query($sql) === TRUE) {
        // Update saldo
        $sql = "UPDATE saldo SET saldo = $saldo_akhir";
        if ($conn->query($sql) === TRUE) {
            echo "Peminjaman berhasil.";
        } else {
            echo "Error: " . $conn->error;
        }
    } else {
        echo "Error: " . $conn->error;
    }
}
?>

<?php
if ($_SERVER["REQUEST_METHOD"] == "POST" && isset($_POST["submit_pengembalian"])) {
    $nama = $_POST["nama"];
    $no_ktp = $_POST["no_ktp"];
    $jumlah_pengembalian = $_POST["jumlah_pengembalian"];

    // Lakukan validasi data

    // Tambahkan jumlah pengembalian ke saldo
    $saldo_awal = 100000000; // Saldo awal
    $saldo_akhir = $saldo_awal + $jumlah_pengembalian;

    // Simpan data pengembalian ke database
    $sql = "INSERT INTO pengembalian (nama, no_ktp, jumlah_pengembalian) VALUES ('$nama', '$no_ktp', '$jumlah_pengembalian')";
    if ($conn->query($sql) === TRUE) {
        // Update saldo
        $sql = "UPDATE saldo SET saldo = $saldo_akhir";
        if ($conn->query($sql) === TRUE) {
            echo "Pengembalian berhasil.";
        } else {
            echo "Error: " . $conn->error;
        }
    } else {
        echo "Error: " . $conn->error;
    }
}
?>

<?php
// Ambil saldo terakhir dari database
$sql = "SELECT saldo FROM saldo";
$result = $conn->query($sql);

if ($result->num_rows > 0) {
    $row = $result->fetch_assoc();
    $saldo_terakhir = $row["saldo"];
} else {
    $saldo_terakhir = 0;
}
?>
